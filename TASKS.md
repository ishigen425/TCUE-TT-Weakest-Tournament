# 投票機能追加タスクリスト

## 全体のタスク概要
- **目標**: 各ユーザーがLocalStorageで制御された1人1回の投票を行い、投票結果をグラフで表示する機能を実装。
- **前提**: Supabaseで投票データを管理。LocalStorageで投票済みフラグを制御（認証不要）。
- **技術スタック**: React（コンポーネント更新）、Supabase（データベース）、Chart.jsまたはRecharts（グラフ表示）、LocalStorage（クライアント側制御）。
- **注意点**: 既存の選手データ（playersテーブル）を活用。投票は選手ごとに行う想定。

## 詳細タスクリスト
1. **Supabaseデータベースの準備（投票テーブル作成）**
   - **目的**: 投票データを保存するためのテーブルを作成。
   - **作業内容**:
     - Supabaseダッシュボードまたはマイグレーションファイルで`votes`テーブルを作成（例: player_id, vote_count, created_at）。
     - 既存のplayersテーブルと関連付け（外部キー）。
     - シードデータを挿入（初期投票カウントを0に設定）。
   - **依存関係**: なし（Supabaseプロジェクトが既に設定済み）。
   - **見積もり時間**: 30分。

2. **Supabaseクライアントの更新（投票APIの追加）**
   - **目的**: 投票データの取得・更新を可能にする。
   - **作業内容**:
     - `src/supabase.js`に投票関連の関数を追加（例: 投票カウントの取得、投票のインクリメント）。
     - 既存のplayersデータ取得関数を拡張。
   - **依存関係**: タスク1完了後。
   - **見積もり時間**: 20分。

3. **LocalStorage制御の実装（投票制限）**
   - **目的**: 各ユーザーが1人1回だけ投票できるように制御。
   - **作業内容**:
     - 投票時にLocalStorageにフラグ（例: "voted_player_id"）をセット。
     - 投票ボタン表示前にLocalStorageをチェック（投票済みならボタンを無効化）。
     - ブラウザのlocalStorage APIを使用（ReactのuseEffectで管理）。
   - **依存関係**: なし（クライアント側のみ）。
   - **見積もり時間**: 30分。

4. **投票UIの実装（選手プロフィールコンポーネントの更新）**
   - **目的**: 各選手に投票ボタンを追加。
   - **作業内容**:
     - `src/components/PlayerProfile.jsx`に投票ボタンを追加（クリックでSupabaseに投票を送信）。
     - ボタンの状態をLocalStorageに基づいて制御（投票済みなら「投票済み」表示）。
     - エラーハンドリング（投票失敗時のメッセージ）。
   - **依存関係**: タスク2・3完了後。
   - **見積もり時間**: 45分。

5. **投票結果の集計と表示（グラフコンポーネントの作成）**
   - **目的**: 投票結果をグラフで可視化。
   - **作業内容**:
     - 新しいコンポーネント（例: `src/components/VoteChart.jsx`）を作成。
     - Chart.jsまたはRechartsをインストール（npm install）。
     - Supabaseから投票データを取得し、棒グラフや円グラフで表示（選手ごとの投票数）。
     - `src/App.jsx`にグラフコンポーネントを統合。
   - **依存関係**: タスク1・2完了後。
   - **見積もり時間**: 1時間。

6. **全体UIの統合とスタイル調整**
   - **目的**: 投票機能とグラフをアプリに統合。
   - **作業内容**:
     - `src/App.jsx`を更新（投票結果のリアルタイム更新、ナビゲーション調整）。
     - `src/components/PlayerProfile.css`を拡張（投票ボタンのスタイル）。
     - レスポンシブデザインを考慮。
   - **依存関係**: タスク4・5完了後。
   - **見積もり時間**: 30分。

7. **テストとデバッグ**
   - **目的**: 機能が正しく動作するか検証。
   - **作業内容**:
     - LocalStorageの動作確認（投票制限）。
     - Supabaseデータの同期確認（投票カウントの更新）。
     - グラフの表示確認（データ変更時の更新）。
     - エッジケース（複数ブラウザ、データリセット）をテスト。
   - **依存関係**: 全タスク完了後。
   - **見積もり時間**: 45分。

8. **デプロイと最終確認**
   - **目的**: Netlifyにデプロイ。
   - **作業内容**:
     - `npm run build`でビルド。
     - Netlifyにプッシュ（GitHub連携で自動デプロイ）。
     - 環境変数（.env）の確認。
   - **依存関係**: 全タスク完了後。
   - **見積もり時間**: 15分。

## 追加の考慮点
- **優先順位**: タスク1～3を先に完了させ、データベースと基本ロジックを固める。
- **リスク**: LocalStorageはブラウザ依存（クッキー削除でリセット可能）。Supabaseのレート制限に注意。
- **拡張性**: 将来的に認証を追加する場合、LocalStorageをSupabase Authに置き換え可能。
- **見積もり総時間**: 約4～5時間（個人差あり）。
